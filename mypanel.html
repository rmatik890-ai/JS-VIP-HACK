<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN - SYSTEM CONTROL</title>
    <style>
        body {
            background-color: #0d0d0d;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: #000;
            border: 2px solid #00ff00;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        h1 {
            text-align: center;
            border-bottom: 2px dashed #00ff00;
            padding-bottom: 15px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stats-card {
            background: #111;
            padding: 15px;
            text-align: center;
            border: 1px solid #333;
            margin-bottom: 25px;
            border-radius: 5px;
        }
        .stats-count {
            font-size: 40px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #00ff00;
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #ccc; font-size: 12px; }
        
        input[type="text"], input[type="url"] {
            width: 100%;
            padding: 12px;
            background: #050505;
            border: 1px solid #333;
            color: #00ff00;
            font-family: monospace;
            font-size: 14px;
            border-radius: 4px;
        }
        input:focus { outline: none; border-color: #00ff00; }

        /* Color Controls */
        .color-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .color-group { flex: 1; }
        
        input[type="color"] {
            width: 100%; height: 40px; background: none; border: 1px solid #333; cursor: pointer;
        }
        
        /* Range Slider for Opacity */
        input[type="range"] {
            width: 100%; cursor: pointer;
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            background: #003300;
            color: #00ff00;
            border: 2px solid #00ff00;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
        }
        .save-btn:hover {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 20px #00ff00;
        }

        .msg { text-align: center; margin-top: 15px; font-size: 12px; min-height: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ADMIN CONFIG</h1>

        <!-- LIVE USER COUNT -->
        <div class="stats-card">
            <div>CURRENT USERS ONLINE</div>
            <div class="stats-count" id="onlineCount">Loading...</div>
        </div>

        <!-- SETTINGS FORM -->
        <div class="input-group">
            <label>APP NAME (Title)</label>
            <input type="text" id="appName" placeholder="Ex: JS VIP HACK">
        </div>

        <div class="input-group">
            <label>GAME WEBSITE URL (Iframe Link)</label>
            <input type="url" id="gameLink" placeholder="https://tkclub5.com/...">
        </div>

        <div class="input-group">
            <label>USER ACCESS PASSWORD</label>
            <input type="text" id="appPass" placeholder="Ex: 1234">
        </div>

        <div class="input-group">
            <label>TELEGRAM GROUP LINK</label>
            <input type="url" id="teleLink" placeholder="https://t.me/yourgroup">
        </div>

        <div class="color-row">
            <div class="color-group">
                <label>BORDER COLOR (Fire)</label>
                <input type="color" id="borderColor" value="#ff0000">
            </div>
            
            <div class="color-group">
                <label>POPUP BACKGROUND COLOR</label>
                <input type="color" id="popupBaseColor" value="#000000">
                <label style="margin-top:5px;">Opacity: <span id="opacityVal">90%</span></label>
                <input type="range" id="popupOpacity" min="0" max="100" value="90">
            </div>
        </div>

        <button class="save-btn" onclick="saveSettings()">UPDATE SERVER</button>
        <div class="msg" id="statusMsg"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCM6zDSvUsBcE5EFYP_FBkfcxRZUlX4FQU",
            authDomain: "jshack-1380f.firebaseapp.com",
            databaseURL: "https://jshack-1380f-default-rtdb.firebaseio.com",
            projectId: "jshack-1380f",
            storageBucket: "jshack-1380f.firebasestorage.app",
            messagingSenderId: "801397882450",
            appId: "1:801397882450:web:566cc8f1741ea41abc698b",
            measurementId: "G-FYZXDDFK3B"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const settingsRef = ref(db, 'settings');
        const onlineRef = ref(db, 'status/onlineCount');

        // Helper: Convert Hex to RGBA
        function hexToRgba(hex, alpha) {
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Opacity Slider Display
        const opacitySlider = document.getElementById('popupOpacity');
        const opacityDisplay = document.getElementById('opacityVal');
        opacitySlider.addEventListener('input', (e) => {
            opacityDisplay.innerText = e.target.value + "%";
        });

        // --- LOAD DATA ---
        onValue(onlineRef, (snap) => {
            document.getElementById('onlineCount').innerText = snap.val() || 0;
        });

        onValue(settingsRef, (snap) => {
            const data = snap.val();
            if(data) {
                if(data.appName) document.getElementById('appName').value = data.appName;
                if(data.gameLink) document.getElementById('gameLink').value = data.gameLink;
                if(data.password) document.getElementById('appPass').value = data.password;
                if(data.telegramLink) document.getElementById('teleLink').value = data.telegramLink;
                if(data.borderColor) document.getElementById('borderColor').value = data.borderColor;
                
                // Note: We can't easily reverse RGBA to Hex+Opacity for the inputs perfectly, 
                // so we keep the inputs as they are or default. 
                // The user just sets new values when they want to update.
            }
        });

        // --- SAVE DATA ---
        window.saveSettings = function() {
            const appName = document.getElementById('appName').value;
            const gameLink = document.getElementById('gameLink').value;
            const password = document.getElementById('appPass').value;
            const telegramLink = document.getElementById('teleLink').value;
            const borderColor = document.getElementById('borderColor').value;
            
            // Handle Popup Color Construction
            const baseColor = document.getElementById('popupBaseColor').value;
            const opacity = document.getElementById('popupOpacity').value / 100;
            const finalPopupColor = hexToRgba(baseColor, opacity);

            const btn = document.querySelector('.save-btn');
            btn.innerText = "UPDATING...";

            update(settingsRef, {
                appName: appName,
                gameLink: gameLink,
                password: password,
                telegramLink: telegramLink,
                borderColor: borderColor,
                popupColor: finalPopupColor
            }).then(() => {
                const msg = document.getElementById('statusMsg');
                msg.innerText = "SUCCESS: SYSTEM UPDATED!";
                msg.style.color = "#00ff00";
                btn.innerText = "UPDATE SERVER";
                setTimeout(() => msg.innerText = "", 3000);
            }).catch((e) => {
                alert("Error: " + e.message);
                btn.innerText = "UPDATE SERVER";
            });
        }
    </script>
</body>
</html>
